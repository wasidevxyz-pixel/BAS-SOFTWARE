<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WH Customer Payment - BAS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="/css/sidebar.css" rel="stylesheet">
    <link href="/css/desktop-style.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet">
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #1e4c8c 0%, #2c5ba9 100%);
            --accent-color: #00d2ff;
            --bg-body: #f0f2f5;
        }

        body {
            background-color: var(--bg-body);
            overflow-x: hidden;
        }

        .main-content {
            background-color: var(--bg-body) !important;
            padding-bottom: 0;
            min-height: 100vh;
        }

        .page-header {
            margin-bottom: 0 !important;
            background: var(--primary-gradient) !important;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: sticky;
            top: 0;
            z-index: 1020;
        }


        .form-label {
            font-weight: 600;
            font-size: 0.8rem;
            margin-bottom: 0.15rem;
            color: #4b5563;
        }

        .form-control,
        .form-select {
            font-size: 0.85rem;
            padding: 0.35rem 0.6rem;
            border-radius: 4px;
            border: 1px solid #d1d5db;
        }

        .card {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            background: #fff;
        }

        .card-header-custom {
            background: #f9fafb;
            color: #1f2937;
            padding: 0.6rem 1rem;
            font-weight: 700;
            border-bottom: 1px solid #e5e7eb;
            border-top-left-radius: 8px;
            border-top-right-radius: 8px;
            font-size: 0.9rem;
        }

        .btn-custom {
            padding: 0.4rem 1rem;
            font-weight: 600;
            border-radius: 4px;
            font-size: 0.85rem;
        }

        .table-custom {
            font-size: 0.8rem;
        }

        .table-custom thead th {
            background-color: #f3f4f6;
            color: #374151;
            font-weight: 700;
            border-bottom: 1px solid #e5e7eb;
            padding: 0.6rem;
        }

        .balance-box {
            background-color: #111827;
            color: #10b981;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 1.5rem;
            padding: 0.4rem;
            border-radius: 4px;
            text-align: center;
        }

        .search-area {
            background-color: #fff;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            margin-bottom: 0.75rem;
            border: 1px solid #e5e7eb;
        }

        .payment-container {
            display: grid;
            grid-template-columns: 340px 1fr;
            gap: 1rem;
            padding: 1rem;
            height: calc(100vh - 55px);
            align-items: start;
        }

        /* Set scroll for the list section only */
        .list-section {
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .table-scroll {
            flex: 1;
            overflow-y: auto;
            border-radius: 8px;
            background: #fff;
            border: 1px solid #e5e7eb;
        }

        @media (max-width: 1200px) {
            .payment-container {
                grid-template-columns: 1fr;
                height: auto;
            }
        }

        /* Header Button Styles from WH Purchase */
        .page-header .btn {
            padding: 0.25rem 0.75rem;
            font-size: 0.75rem;
            border-radius: 4px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.2s;
            height: 32px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 500;
        }

        .btn-header-light {
            background: rgba(255, 255, 255, 0.15);
        }

        .btn-header-light:hover {
            background: rgba(255, 255, 255, 0.3);
            color: white;
            border-color: white;
        }

        .btn-header-success {
            background: #28a745;
            border-color: #28a745 !important;
        }

        .btn-header-success:hover {
            background: #218838;
            filter: brightness(1.1);
        }

        .btn-header-warning {
            background: #ffc107;
            color: #212529 !important;
            border-color: #ffc107 !important;
        }

        .btn-header-warning:hover {
            background: #e0a800;
        }

        /* Form Footer Action Buttons */
        .action-buttons .btn {
            padding: 0.2rem 0.4rem;
            font-size: 0.7rem;
            height: 30px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            border-radius: 4px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            flex: 1;
            min-width: 0;
            /* Allow shrinking */
            white-space: nowrap;
        }

        .btn-action-success {
            background: #28a745;
            border-color: #28a745;
        }

        .btn-action-success:hover {
            background: #218838;
        }

        .btn-action-primary {
            background: #007bff;
            border-color: #007bff;
        }

        .btn-action-primary:hover {
            background: #0069d9;
        }

        .btn-action-info {
            background: #17a2b8;
            border-color: #17a2b8;
        }

        .btn-action-info:hover {
            background: #138496;
        }

        .btn-action-warning {
            background: #ffc107;
            color: #212529 !important;
            border-color: #ffc107;
        }

        .btn-action-warning:hover {
            background: #e0a800;
        }

        /* Autocomplete Styles */
        .suggestion-item {
            cursor: pointer;
            padding: 8px 12px;
            border-bottom: 1px solid #eee;
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        .suggestion-item:hover,
        .suggestion-item.active {
            background-color: #343a40;
            color: white;
        }

        .suggestion-item:hover .text-muted,
        .suggestion-item.active .text-muted {
            color: #d1d1d1 !important;
        }

        :root {
            --primary-gradient: linear-gradient(135deg, #1e4c8c 0%, #2c5ba9 100%);
            --accent-color: #00d2ff;
            --bg-body: #f0f2f5;
        }

        body {
            background-color: var(--bg-body);
            overflow-x: hidden;
        }

        .main-content {
            background-color: var(--bg-body) !important;
            padding-bottom: 0;
            min-height: 100vh;
        }

        .page-header {
            margin-bottom: 0 !important;
            background: var(--primary-gradient) !important;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: sticky;
            top: 0;
            z-index: 1020;
        }


        .form-label {
            font-weight: 600;
            font-size: 0.8rem;
            margin-bottom: 0.15rem;
            color: #4b5563;
        }

        .form-control,
        .form-select {
            font-size: 0.85rem;
            padding: 0.35rem 0.6rem;
            border-radius: 4px;
            border: 1px solid #d1d5db;
        }

        .card {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            background: #fff;
        }

        .card-header-custom {
            background: #f9fafb;
            color: #1f2937;
            padding: 0.6rem 1rem;
            font-weight: 700;
            border-bottom: 1px solid #e5e7eb;
            border-top-left-radius: 8px;
            border-top-right-radius: 8px;
            font-size: 0.9rem;
        }

        .btn-custom {
            padding: 0.4rem 1rem;
            font-weight: 600;
            border-radius: 4px;
            font-size: 0.85rem;
        }

        .table-custom {
            font-size: 0.8rem;
        }

        .table-custom thead th {
            background-color: #f3f4f6;
            color: #374151;
            font-weight: 700;
            border-bottom: 1px solid #e5e7eb;
            padding: 0.6rem;
        }

        .balance-box {
            background-color: #111827;
            color: #10b981;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 1.5rem;
            padding: 0.4rem;
            border-radius: 4px;
            text-align: center;
        }

        .search-area {
            background-color: #fff;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            margin-bottom: 0.75rem;
            border: 1px solid #e5e7eb;
        }

        .payment-container {
            display: grid;
            grid-template-columns: 340px 1fr;
            gap: 1rem;
            padding: 1rem;
            height: calc(100vh - 55px);
            align-items: start;
        }

        /* Set scroll for the list section only */
        .list-section {
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .table-scroll {
            flex: 1;
            overflow-y: auto;
            border-radius: 8px;
            background: #fff;
            border: 1px solid #e5e7eb;
        }

        @media (max-width: 1200px) {
            .payment-container {
                grid-template-columns: 1fr;
                height: auto;
            }
        }

        /* Header Button Styles from WH Purchase */
        .page-header .btn {
            padding: 0.25rem 0.75rem;
            font-size: 0.75rem;
            border-radius: 4px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.2s;
            height: 32px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 500;
        }

        .btn-header-light {
            background: rgba(255, 255, 255, 0.15);
        }

        .btn-header-light:hover {
            background: rgba(255, 255, 255, 0.3);
            color: white;
            border-color: white;
        }

        .btn-header-success {
            background: #28a745;
            border-color: #28a745 !important;
        }

        .btn-header-success:hover {
            background: #218838;
            filter: brightness(1.1);
        }

        .btn-header-warning {
            background: #ffc107;
            color: #212529 !important;
            border-color: #ffc107 !important;
        }

        .btn-header-warning:hover {
            background: #e0a800;
        }

        /* Form Footer Action Buttons */
        .action-buttons .btn {
            padding: 0.2rem 0.4rem;
            font-size: 0.7rem;
            height: 30px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            border-radius: 4px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            flex: 1;
            min-width: 0;
            /* Allow shrinking */
            white-space: nowrap;
        }

        .btn-action-success {
            background: #28a745;
            border-color: #28a745;
        }

        .btn-action-success:hover {
            background: #218838;
        }

        .btn-action-primary {
            background: #007bff;
            border-color: #007bff;
        }

        .btn-action-primary:hover {
            background: #0069d9;
        }

        .btn-action-info {
            background: #17a2b8;
            border-color: #17a2b8;
        }

        .btn-action-info:hover {
            background: #138496;
        }

        .btn-action-warning {
            background: #ffc107;
            color: #212529 !important;
            border-color: #ffc107;
        }

        .btn-action-warning:hover {
            background: #e0a800;
        }

        /* Autocomplete Styles */
        .suggestion-item {
            cursor: pointer;
            padding: 8px 12px;
            border-bottom: 1px solid #eee;
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        .suggestion-item:hover,
        .suggestion-item.active {
            background-color: #343a40;
            color: white;
        }

        .suggestion-item:hover .text-muted,
        .suggestion-item.active .text-muted {
            color: #d1d1d1 !important;
        }

        /* Professional Mobile Enhancements */
        @media (max-width: 768px) {
            .page-header {
                padding: 0.5rem 1rem !important;
                background: var(--primary-gradient) !important;
            }

            .page-header h6 {
                font-size: 1rem !important;
            }

            .payment-container {
                display: block !important;
                padding: 10px !important;
                padding-bottom: 80px !important;
                height: auto !important;
            }

            .entry-section,
            .list-section {
                width: 100% !important;
            }

            .list-section {
                display: none !important;
                /* Managed by toggle */
            }

            .card {
                border-radius: 12px !important;
                border: none !important;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08) !important;
                margin-bottom: 15px !important;
            }

            .form-label {
                font-size: 0.75rem !important;
                color: #64748b !important;
            }

            .form-control,
            .form-select {
                height: 38px !important;
                font-size: 0.85rem !important;
                border-radius: 8px !important;
            }

            .balance-box {
                font-size: 1.25rem !important;
            }

            /* Bottom Action Bar */
            .action-bar-mobile {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background: white;
                display: flex !important;
                justify-content: space-around;
                padding: 8px 5px;
                box-shadow: 0 -2px 15px rgba(0, 0, 0, 0.1);
                z-index: 1050;
                border-top: 1px solid #e2e8f0;
                height: 65px;
            }

            .action-btn-mobile {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                background: none;
                border: none;
                color: #64748b;
                font-size: 0.65rem;
                font-weight: 600;
                flex: 1;
                transition: all 0.2s;
            }

            .action-btn-mobile i {
                font-size: 1.25rem;
                margin-bottom: 3px;
            }

            .action-btn-mobile:active {
                color: #2c5ba9;
            }

            .action-btn-mobile.btn-save i {
                color: #10b981;
            }

            .action-btn-mobile.btn-print i {
                color: #3b82f6;
            }

            .action-btn-mobile.btn-list i {
                color: #f59e0b;
            }

            .action-btn-mobile.btn-toggle i {
                color: #6366f1;
            }

            .action-buttons.d-flex.gap-1.mt-auto.pt-3.border-top {
                display: none !important;
                /* Hide desktop buttons */
            }

            .search-area .row.g-2>div {
                margin-bottom: 10px;
            }

            .table-scroll {
                height: calc(100vh - 250px) !important;
            }
        }
    </style>
</head>

<body>
    <div id="sidebar-container"></div>

    <div class="main-content">
        <div
            class="page-header px-3 py-2 d-flex justify-content-between align-items-center bg-primary text-white shadow-sm">
            <div class="d-flex align-items-center">
                <i class="fas fa-bars me-3 text-white" id="sidebarToggle"
                    style="cursor:pointer; font-size: 1.1rem;"></i>
                <h6 class="mb-0 text-white fw-bold"><i class="fas fa-money-bill-wave me-2"></i>WH CUSTOMER PAYMENT</h6>
            </div>
            <div id="header-actions" class="d-flex align-items-center gap-2">
                <!-- Buttons moved to form footer -->
            </div>


        </div>

        <div class="container-fluid p-0">
            <div class="payment-container">
                <!-- Left Column: Entry Form -->
                <div class="entry-section">
                    <form id="paymentForm">
                        <input type="hidden" id="paymentId">
                        <div class="card h-100">
                            <div class="card-header-custom">
                                PAYMENT ENTRY
                            </div>
                            <div class="card-body p-3">
                                <div class="mb-2">
                                    <label class="form-label">Payment Type</label>
                                    <select class="form-select" id="paymentType" required>
                                        <option value="Received">Received</option>
                                        <option value="Pay">Pay</option>
                                    </select>
                                </div>
                                <div class="mb-2">
                                    <label class="form-label">Date</label>
                                    <input type="date" class="form-control" id="date" required>
                                </div>
                                <div class="mb-2">
                                    <label class="form-label">Customer</label>
                                    <div class="input-group position-relative">
                                        <!-- Hidden Select to maintain compatibility with existing JS logic -->
                                        <select class="form-select d-none" id="customer" required>
                                            <option value="">Select Customer</option>
                                        </select>

                                        <!-- Search Input -->
                                        <input type="text" class="form-control" id="customerSearch"
                                            placeholder="Type to search customer..." autocomplete="off">

                                        <button type="button" class="btn btn-outline-secondary btn-sm"
                                            onclick="loadCustomers()">
                                            <i class="fas fa-sync-alt"></i>
                                        </button>

                                        <!-- Suggestions Dropdown -->
                                        <div id="customerSuggestions"
                                            class="list-group position-absolute w-100 shadow-sm"
                                            style="top: 100%; left: 0; z-index: 1050; max-height: 200px; overflow-y: auto; display: none;">
                                        </div>
                                    </div>
                                </div>
                                <div class="mb-2">
                                    <label class="form-label">Previous Balance</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control fw-bold" id="previousBalance" readonly
                                            value="0"
                                            style="background-color: #f0f9ff; color: #0369a1; border-color: #bae6fd;">
                                        <button class="btn btn-outline-primary btn-sm" type="button"
                                            onclick="syncBalance()">
                                            <i class="fas fa-sync-alt"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="mb-2">
                                    <label class="form-label">Amount</label>
                                    <input type="number" class="form-control form-control-lg fw-bold" id="amount"
                                        placeholder="0.00" required step="0.01">
                                </div>
                                <div class="row g-2 mb-2">
                                    <div class="col-6">
                                        <label class="form-label">Discount %</label>
                                        <input type="number" class="form-control" id="discountPercent" value="0">
                                    </div>
                                    <div class="col-6">
                                        <label class="form-label">Discount (Rs)</label>
                                        <input type="number" class="form-control" id="discountAmount" value="0">
                                    </div>
                                </div>
                                <div class="mb-2">
                                    <label class="form-label">Balance After Payment</label>
                                    <input type="number" class="form-control fw-bold" id="balance" readonly value="0"
                                        style="background-color: #f0fdf4; color: #166534; border-color: #bbf7d0;">
                                </div>
                                <div class="mb-2">
                                    <label class="form-label">Payment Mode</label>
                                    <select class="form-select" id="paymentMode" required>
                                        <option value="Cash">Cash</option>
                                        <option value="Bank">Bank</option>
                                        <option value="Cheque">Cheque</option>
                                        <option value="Online">Online</option>
                                    </select>
                                </div>
                                <div id="bankInfo" class="mb-2 d-none">
                                    <label class="form-label">Bank Name / Details</label>
                                    <input type="text" class="form-control" id="bankName" placeholder="Enter bank info">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Cash In Hand</label>
                                    <div class="balance-box" id="cashInHand">0.00</div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Remarks</label>
                                    <textarea class="form-control" id="remarks" rows="1"
                                        placeholder="Optional remarks"></textarea>
                                </div>

                                <!-- Action Buttons in One Row -->
                                <div class="action-buttons d-flex gap-1 mt-auto pt-3 border-top">
                                    <button type="button" id="btnSave" class="btn btn-action-success"
                                        onclick="document.getElementById('paymentForm').requestSubmit()">
                                        <i class="fas fa-save me-1"></i>SAVE
                                    </button>
                                    <button type="button" class="btn btn-action-primary" onclick="printVoucher()">
                                        <i class="fas fa-print me-1"></i>PRINT
                                    </button>
                                    <button type="button" class="btn btn-action-info" onclick="viewLedger()">
                                        <i class="fas fa-book me-1"></i>LEDGER
                                    </button>
                                    <button type="button" class="btn btn-action-warning" onclick="resetForm()">
                                        <i class="fas fa-eraser me-1"></i>CLEAR
                                    </button>
                                </div>
                            </div>

                        </div>
                    </form>
                </div>


                <!-- Right Column: List & Filter -->
                <div class="list-section">
                    <div class="search-area shadow-sm">
                        <div class="row g-2 align-items-end">
                            <div class="col-md-3">
                                <label class="form-label">From Date</label>
                                <input type="date" class="form-control" id="filterFrom">
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">To Date</label>
                                <input type="date" class="form-control" id="filterTo">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Search Customer / Receipt #</label>
                                <div class="input-group">
                                    <span class="input-group-text bg-white"><i
                                            class="fas fa-search text-muted"></i></span>
                                    <input type="text" class="form-control" id="filterSearch" placeholder="Search...">
                                </div>
                            </div>
                            <div class="col-md-2">
                                <button class="btn btn-primary btn-custom w-100 fw-bold" onclick="loadPayments()">
                                    SEARCH
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="table-scroll shadow-sm">
                        <table class="table table-custom table-hover mb-0" id="paymentsTable">
                            <thead class="sticky-top">
                                <tr>
                                    <th>ID</th>
                                    <th>Dated</th>
                                    <th>Customer Name</th>
                                    <th>Type</th>
                                    <th class="text-end">Pre Balance</th>
                                    <th class="text-end">Amount</th>
                                    <th class="text-end">Discount</th>
                                    <th class="text-end">Balance</th>
                                    <th>Mode</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="paymentsBody">
                                <!-- Data will be loaded here -->
                            </tbody>
                            <tfoot class="bg-light fw-bold sticky-bottom">
                                <tr>
                                    <td colspan="5" class="text-end text-muted">TOTALS:</td>
                                    <td class="text-end text-primary" id="totalAmountSum">0.00</td>
                                    <td class="text-end text-danger" id="totalDiscountSum">0.00</td>
                                    <td colspan="3"></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>

    <!-- Voucher Print Template (Hidden) -->
    <div id="printArea" style="display: none;">
        <div class="voucher-print">
            <!-- Content will be generated dynamically -->
        </div>
    </div>

    <!-- Mobile Bottom Action Bar -->
    <div class="action-bar-mobile d-none">
        <button type="button" class="action-btn-mobile btn-toggle" id="mobileToggleBtn" onclick="toggleMobileView()">
            <i class="fas fa-list-alt"></i>
            <span id="toggleText">View List</span>
        </button>
        <button type="button" class="action-btn-mobile btn-save"
            onclick="document.getElementById('paymentForm').requestSubmit()">
            <i class="fas fa-save"></i>
            <span>Save</span>
        </button>
        <button type="button" class="action-btn-mobile btn-print" onclick="printVoucher()">
            <i class="fas fa-print"></i>
            <span>Print</span>
        </button>
        <button type="button" class="action-btn-mobile btn-clear" onclick="resetForm()">
            <i class="fas fa-undo"></i>
            <span>Clear</span>
        </button>
    </div>

    <script>
        function toggleMobileView() {
            const entrySection = document.querySelector('.entry-section');
            const listSection = document.querySelector('.list-section');
            const toggleText = document.getElementById('toggleText');
            const toggleIcon = document.querySelector('#mobileToggleBtn i');

            if (entrySection.style.display !== 'none') {
                entrySection.style.setProperty('display', 'none', 'important');
                listSection.style.setProperty('display', 'flex', 'important');
                toggleText.innerText = 'View Entry';
                toggleIcon.className = 'fas fa-edit';
            } else {
                entrySection.style.setProperty('display', 'block', 'important');
                listSection.style.setProperty('display', 'none', 'important');
                toggleText.innerText = 'View List';
                toggleIcon.className = 'fas fa-list-alt';
            }
        }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/sidebar.js"></script>
    <script src="/js/pageAccess.js"></script>
    <script src="/js/wh-customer-payment.js"></script>
</body>

</html>