<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Commission</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/desktop-style.css" rel="stylesheet">
    <link href="/css/sidebar.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .page-header {
            background: #007bff;
            color: white;
            padding: 10px;
        }

        /* Tab Navigation - Horizontal Layout */
        .nav-tabs {
            display: flex !important;
            flex-direction: row !important;
            flex-wrap: nowrap !important;
            align-items: stretch !important;
            justify-content: flex-start !important;

            overflow-x: auto !important;
            overflow-y: hidden !important;
            white-space: nowrap !important;

            border-bottom: 2px solid #dee2e6 !important;
            background: #f8f9fa !important;

            padding: 0 !important;
            margin: 0 !important;
            gap: 0 !important;
        }

        .nav-tabs::-webkit-scrollbar {
            height: 6px;
        }

        .nav-tabs::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .nav-tabs::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 3px;
        }

        .nav-tabs::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        .nav-tabs .nav-item {
            display: flex !important;
            flex: 0 0 auto !important;
            width: auto !important;
            margin: 0 !important;
            padding: 0 !important;
            border: none !important;
            background: transparent !important;
        }

        .nav-tabs .nav-link {
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;

            border-radius: 0 !important;
            border: 1px solid #dee2e6 !important;
            border-right: none !important;
            border-bottom: none !important;

            padding: 8px 16px !important;
            margin: 0 !important;

            color: #495057 !important;
            background: #e9ecef !important;
            font-weight: 500 !important;
            font-size: 0.875rem !important;
            white-space: nowrap !important;

            transition: all 0.2s ease !important;
            height: 100% !important;
        }

        /* Add right border to last tab only */
        .nav-tabs .nav-item:last-child .nav-link {
            border-right: 1px solid #dee2e6 !important;
        }

        .nav-tabs .nav-link:hover {
            background: #d4d7db !important;
            color: #212529 !important;
        }

        .nav-tabs .nav-link.active {
            background-color: #007bff !important;
            color: white !important;
            border-color: #007bff !important;
            font-weight: 600 !important;
            box-shadow: none !important;
            z-index: 2 !important;
        }

        .table-custom th {
            background-color: #007bff;
            color: white;
        }

        .sub-header {
            background: #e9ecef;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
        }

        .tab-pane {
            padding-top: 15px;
        }

        /* Exact 'Half-Page' List Style Match */
        .custom-list-header {
            background-color: #0076ad;
            color: white;
            padding: 5px 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 15px;
            font-weight: bold;
            height: 40px;
        }

        .search-area-container {
            background: #fff;
            padding: 15px;
            border-bottom: 2px solid #333;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        /* Locked Row Style - When Payroll Exists */
        tr.row-locked {
            background-color: #fff3cd !important;
            /* Warning yellow */
            transition: all 0.3s ease;
        }

        tr.row-locked input {
            background-color: transparent !important;
            pointer-events: none;
            /* Disable mouse interactions */
            border: 1px solid transparent !important;
            color: #856404 !important;
            font-weight: bold !important;
        }

        tr.row-locked .locked-badge {
            font-size: 0.65rem;
            background: #856404;
            color: white;
            padding: 2px 4px;
            border-radius: 3px;
            margin-left: 5px;
            vertical-align: middle;
        }

        .custom-search-box {
            background: #fff;
            border: 1px solid #333;
            padding: 5px 12px;
            font-size: 22px;
            flex: 1;
            outline: none;
            font-family: 'Times New Roman', Times, serif;
        }

        .list-shortcut {
            font-size: 14px;
            font-weight: bold;
            color: #333;
            white-space: nowrap;
        }

        .table-half-page thead th {
            background-color: #0076ad !important;
            color: #fff !important;
            border: 1px solid #fff !important;
            padding: 10px !important;
            font-size: 14px;
            text-transform: capitalize;
        }

        /* Color Palette from Reference Image */
        .cell-blue-light {
            background-color: #e8f0fe !important;
        }

        .cell-blue-medium {
            background-color: #a2c4e8 !important;
        }

        .cell-green {
            background-color: #9dd8c8 !important;
        }

        .cell-pink {
            background-color: #f9adae !important;
        }

        .cell-purple {
            background-color: #c5b4e3 !important;
        }

        .btn-select-custom {
            background-color: #0076ad;
            color: white;
            border: none;
            padding: 5px 10px;
            font-size: 12px;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 5px;
            text-transform: capitalize;
        }

        .btn-select-custom:hover {
            background-color: #005a85;
            color: #fff;
        }

        /* Professional Mobile Enhancements */
        @media (max-width: 768px) {
            .page-header {
                padding: 0.5rem 1rem !important;
                background: #007bff !important;
            }

            .page-header #userName,
            .page-header .fa-chevron-down {
                display: none;
            }

            .container-fluid {
                padding: 10px !important;
                padding-bottom: 80px !important;
            }

            .sub-header {
                padding: 15px !important;
                border: none !important;
                box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05) !important;
            }

            .nav-tabs {
                border-bottom: none !important;
                background: white !important;
                border-radius: 12px !important;
                margin-bottom: 15px !important;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05) !important;
            }

            .nav-tabs .nav-link {
                font-size: 0.75rem !important;
                padding: 10px 12px !important;
                border: none !important;
                border-radius: 8px !important;
            }

            .nav-tabs .nav-link.active {
                background-color: #007bff !important;
            }

            .table-responsive {
                border-radius: 12px !important;
                overflow: auto !important;
            }

            .table-sm th,
            .table-sm td {
                font-size: 0.75rem !important;
                padding: 8px 4px !important;
            }

            /* Bottom Action Bar */
            .action-bar-mobile {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background: white;
                display: flex !important;
                justify-content: space-around;
                padding: 8px 5px;
                box-shadow: 0 -2px 15px rgba(0, 0, 0, 0.1);
                z-index: 1050;
                border-top: 1px solid #e2e8f0;
                height: 65px;
            }

            .action-btn-mobile {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                background: none;
                border: none;
                color: #64748b;
                font-size: 0.65rem;
                font-weight: 600;
                flex: 1;
                transition: all 0.2s;
            }

            .action-btn-mobile i {
                font-size: 1.25rem;
                margin-bottom: 3px;
            }

            .action-btn-mobile.btn-save i {
                color: #10b981;
            }

            .action-btn-mobile.btn-list i {
                color: #f59e0b;
            }

            .action-btn-mobile.btn-search i {
                color: #3b82f6;
            }

            .action-btn-mobile.btn-refresh i {
                color: #64748b;
            }

            /* Hide desktop buttons in sub-header */
            .col-md-4.d-flex.gap-2.align-items-end {
                display: none !important;
            }
        }
    </style>
</head>

<body>
    <!-- Header -->
    <div class="page-header px-3">
        <div style="flex: 1; display: flex; align-items: center;">
            <i class="fas fa-bars me-3" id="sidebarToggle" style="cursor:pointer; font-size: 1rem;"></i>
            <i class="fas fa-percent me-2"></i> Employee Commission
        </div>
        <div style="flex: 1; display: flex; justify-content: flex-end; align-items: center;">
            <div class="dropdown">
                <div class="d-flex align-items-center text-white" data-bs-toggle="dropdown" style="cursor: pointer;">
                    <i class="fas fa-user-circle me-2" style="font-size: 1.2rem;"></i>
                    <span id="userName" class="me-2">User</span>
                    <i class="fas fa-chevron-down" style="font-size: 0.7rem;"></i>
                </div>
                <ul class="dropdown-menu dropdown-menu-end shadow-sm">
                    <li><a class="dropdown-item logout-btn" href="#"><i
                                class="fas fa-sign-out-alt me-2 text-danger"></i>Sign Out</a></li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container-fluid p-3">
        <!-- Global Filters -->
        <div class="sub-header">
            <div class="row align-items-center g-2">
                <div class="col-md-2">
                    <label class="fw-bold small">Branch</label>
                    <select id="mainBranch" class="form-select form-select-sm" autocomplete="off">
                        <option value="">Select Branch</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <label class="fw-bold small">Month-Year</label>
                    <input type="month" id="mainMonthYear" class="form-control form-control-sm" autocomplete="off">
                </div>
                <div class="col-md-2">
                    <label class="fw-bold small">Department</label>
                    <select id="globalDepartment" class="form-select form-select-sm" autocomplete="off">
                        <option value="Medicine">Medicine</option>
                        <option value="Cosmetics">Cosmetics</option>
                        <option value="General">General</option>
                    </select>
                </div>
                <div class="col-md-4 d-flex gap-2 align-items-end">
                    <!-- Search button triggers data load -->
                    <button class="btn btn-primary btn-sm" onclick="loadCurrentTab()">Search</button>
                    <input type="text" id="globalSearch" class="form-control form-control-sm"
                        placeholder="Search in table..." style="width: 150px;" onkeyup="applyGlobalSearch()">
                    <button class="btn btn-success btn-sm" onclick="saveCurrentTab()" title="Alt + S">Save
                        (Alt+S)</button>
                    <button class="btn btn-info btn-sm text-white" onclick="showCommissionList()">List</button>
                </div>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="item-wise-tab" data-bs-toggle="tab" data-bs-target="#item-wise"
                    type="button" role="tab" onclick="setTab('dep_item_wise')">Dep Item Wise Commission</button>
            </li>

            <li class="nav-item" role="presentation">
                <button class="nav-link" id="distribute-tab" data-bs-toggle="tab" data-bs-target="#distribute"
                    type="button" role="tab" onclick="setTab('distribute')">Distribute Employee All Commission</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="rotti-nashta-tab" data-bs-toggle="tab" data-bs-target="#rotti-nashta"
                    type="button" role="tab" onclick="setTab('rotti_nashta')">Employee Rotti & Nashta</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="rotti-perks-tab" data-bs-toggle="tab" data-bs-target="#rotti-perks"
                    type="button" role="tab" onclick="setTab('rotti_perks')">Employee Rotti Perks</button>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content" id="myTabContent">

            <!-- 1. Dep Item Wise Commission -->
            <div class="tab-pane fade show active" id="item-wise" role="tabpanel">
                <div class="card p-3 border-0 bg-light">
                    <div class="row mb-2">
                        <div class="col-md-3">
                            <select id="whItemCategory" class="form-select form-select-sm"
                                onchange="filterItemWiseTable()" autocomplete="off">
                                <option value="">Select WH Category</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <select id="commissionItemCategory" class="form-select form-select-sm"
                                onchange="filterItemWiseTable()" autocomplete="off">
                                <option value="">Select Comm. Category</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <input type="text" id="itemSearch" class="form-control form-control-sm"
                                placeholder="Search Item Name/Code..." onkeyup="applyLocalFilter()">
                        </div>
                        <div class="col-md-3 d-flex gap-2">
                            <button class="btn btn-sm btn-outline-secondary w-50" onclick="clearItemFilters()">Clear
                                Filters</button>
                            <button class="btn btn-sm btn-warning text-white w-50"
                                onclick="printCommission()">Print</button>
                        </div>
                    </div>

                    <div class="table-responsive">
                        <table class="table table-bordered table-sm table-striped table-hover bg-white text-center">
                            <thead class="table-custom">
                                <tr>
                                    <th>ID</th>
                                    <th>Product</th>
                                    <th>Incentive</th>
                                    <th>Qty</th>
                                    <th>Total</th>
                                </tr>
                            </thead>
                            <tbody id="itemWiseBody">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>



            <!-- 3. Distribute Employee All Commission -->
            <div class="tab-pane fade" id="distribute" role="tabpanel">
                <div class="card p-3 border-0 bg-light">
                    <div class="row mb-2">
                        <div class="col-md-12 text-end">
                            <button class="btn btn-sm btn-warning text-white" onclick="printCommission()">Print</button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-bordered table-sm table-striped table-hover bg-white text-center">
                            <thead class="table-custom">
                                <tr>
                                    <th>ID</th>
                                    <th>Employee Name</th>
                                    <th>Other Commission</th>
                                    <th>UG Commission</th>
                                    <th>WareHouse Comm</th>
                                    <th>Total Commission</th>
                                </tr>
                            </thead>
                            <tbody id="distributeBody">
                            </tbody>
                            <tfoot>
                                <tr class="fw-bold">
                                    <td colspan="2" class="text-end">Total</td>
                                    <td id="distOtherTotal">0</td>
                                    <td id="distUgTotal">0</td>
                                    <td id="distWarehouseTotal">0</td>
                                    <td id="distGrandTotal">0</td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>

            <!-- 4. Employee Rotti & Nashta -->
            <div class="tab-pane fade" id="rotti-nashta" role="tabpanel">
                <div class="card p-3 border-0 bg-light">
                    <div class="row mb-2 align-items-center">
                        <div class="col-md-4">
                            <input type="text" id="rottiSearch" class="form-control form-control-sm"
                                placeholder="Search Employee Name/Code..." onkeyup="applyRottiFilter()">
                        </div>
                        <div class="col-md-8 text-end">
                            <button class="btn btn-sm btn-warning text-white" onclick="printCommission()">Print</button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-bordered table-sm table-striped table-hover bg-white text-center">
                            <thead class="table-custom">
                                <tr>
                                    <th>ID</th>
                                    <th>Employee Name</th>
                                    <th>Nashta Days</th>
                                    <th>Nashta Total</th>
                                    <th>Rotti Days</th>
                                    <th>Rotti Total</th>
                                    <th>Total</th>
                                </tr>
                            </thead>
                            <tbody id="rottiNashtaBody">
                            </tbody>
                            <tfoot>
                                <tr class="fw-bold">
                                    <td colspan="3" class="text-end">Total</td>
                                    <td id="rottiNashtaColumnTotal">0</td>
                                    <td></td>
                                    <td id="rottiColumnTotal">0</td>
                                    <td id="rottiNashtaTotal">0</td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>

            <!-- 5. Employee Rotti Perks -->
            <div class="tab-pane fade" id="rotti-perks" role="tabpanel">
                <div class="card p-3 border-0 bg-light">
                    <div class="row align-items-end mb-2">
                        <div class="col-md-3">
                            <label class="small fw-bold">From</label>
                            <input type="date" id="perksFromDate" class="form-control form-control-sm">
                        </div>
                        <div class="col-md-3">
                            <label class="small fw-bold">To</label>
                            <input type="date" id="perksToDate" class="form-control form-control-sm">
                        </div>
                        <div class="col-md-4">
                            <label class="small fw-bold">Search</label>
                            <input type="text" id="perksSearch" class="form-control form-control-sm"
                                placeholder="Search Employee..." onkeyup="applyPerksFilter()">
                        </div>
                        <div class="col-md-2">
                            <button class="btn btn-sm btn-warning text-white w-100"
                                onclick="printCommission()">Print</button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-bordered table-sm table-striped table-hover bg-white text-center">
                            <thead class="table-custom">
                                <tr>
                                    <th>Sr.</th>
                                    <th>ID</th>
                                    <th>Employee Name</th>
                                    <th>Basic Salary</th>
                                    <th>Worked Days</th>
                                    <th>Rotti</th>
                                    <th>Rotti Times</th>
                                    <th>Nashta</th>
                                    <th>Nashta Total</th>
                                    <th>Total</th>
                                </tr>
                            </thead>
                            <tbody id="rottiPerksBody">
                            </tbody>
                            <tfoot>
                                <tr class="fw-bold">
                                    <td colspan="9" class="text-end">Total</td>
                                    <td id="rottiPerksGrandTotal">0</td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <div class="modal fade" id="commissionListModal" tabindex="-1">
        <div class="modal-dialog modal-fullscreen m-0" style="max-width: 100%;">
            <div class="modal-content border-0 rounded-0 shadow-lg h-100">
                <!-- Top Blue Bar -->
                <div class="custom-list-header">
                    <span></span> <!-- Spacer Or Title if Needed -->
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        aria-label="Close"></button>
                </div>

                <div class="modal-body p-0">
                    <!-- Search Box & Shortcuts -->
                    <div class="search-area-container">
                        <div class="d-flex gap-2 align-items-center flex-grow-1">
                            <input type="text" id="modalListSearch" class="custom-search-box" placeholder="Search.."
                                onkeyup="filterModalList()" autofocus style="flex: 2;">
                            <select id="modalBranchFilter" class="form-select form-select-sm"
                                onchange="filterModalList()" style="flex: 1; height: 45px; border-radius: 8px;">
                                <option value="">All Branches</option>
                            </select>
                            <select id="modalTypeFilter" class="form-select form-select-sm" onchange="filterModalList()"
                                style="flex: 1; height: 45px; border-radius: 8px;">
                                <option value="">All Types</option>
                                <option value="dep_item_wise">ITEM WISE</option>
                                <option value="distribute">DISTRIBUTE</option>
                                <option value="rotti_nashta">ROTTI & NASHTA</option>
                                <option value="rotti_perks">ROTTI PERKS</option>
                            </select>
                        </div>
                        <div class="d-flex gap-5 ms-3">
                            <span class="list-shortcut">SEARCH : ctrl</span>
                            <span class="list-shortcut">SELECT ITEM : alt+b</span>
                        </div>
                    </div>

                    <div class="table-responsive" style="max-height: calc(100vh - 120px);">
                        <table class="table table-bordered mb-0 align-middle text-center table-half-page">
                            <thead>
                                <tr>
                                    <th style="width: 100px;">Select</th>
                                    <th>Period</th>
                                    <th>Branch</th>
                                    <th>Type</th>
                                    <th>Category/Search</th>
                                    <th>Saved At</th>
                                    <th style="width: 120px;">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="commissionListBody" class="bg-white">
                                <!-- JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Bottom Action Bar -->
    <div class="action-bar-mobile d-none">
        <button type="button" class="action-btn-mobile btn-refresh" onclick="location.reload()">
            <i class="fas fa-sync-alt"></i>
            <span>Refresh</span>
        </button>
        <button type="button" class="action-btn-mobile btn-search" onclick="loadCurrentTab()">
            <i class="fas fa-search"></i>
            <span>Search</span>
        </button>
        <button type="button" class="action-btn-mobile btn-save" onclick="saveCurrentTab()">
            <i class="fas fa-save"></i>
            <span>Save</span>
        </button>
        <button type="button" class="action-btn-mobile btn-list" onclick="showCommissionList()">
            <i class="fas fa-list-alt"></i>
            <span>List</span>
        </button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/pageAccess.js"></script>
    <script src="/js/sidebar.js"></script>
    <script src="/js/employee-commission.js"></script>
</body>

</html>